apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: node-dev
  name: node-dev
spec:
  replicas: 1
  selector:
    matchLabels:
      app: node-dev
  template:
    metadata:
      labels:
        app: node-dev
    spec:
      securityContext:
        runAsUser: 1000
        fsGroup: 1000
        fsGroupChangePolicy: "OnRootMismatch"
      volumes:
        - name: node-dev-data
          persistentVolumeClaim:
            claimName: node-dev-data
        - name: node-dev-home
          persistentVolumeClaim:
            claimName: node-dev-home
      containers:
        - image: cr.local.ongy.net/dev/angular
          command: [/usr/bin/code]
          args:
          - serve-web
          - --host
          - 0.0.0.0
          - --without-connection-token
          imagePullPolicy: Always
#          readinessProbe:
#            httpGet:
#              path: /
#              port: 8080
#          env:
#            - name: PUID
#              value: "1005"
#            - name: GUID
#              value: "1004"
#            - name: UMASK
#              value: "002"
          securityContext:
            privileged: false
            runAsNonRoot: true
          name: node-dev
          volumeMounts:
            - mountPath: "/data"
              name: node-dev-data
            - mountPath: "/home/ubuntu"
              name: node-dev-home
#          resources:
#            requests:
#              memory: 256Mi
#              cpu: "100m"
#            limits:
#              memory: 512Mi
#              cpu: "500m"
